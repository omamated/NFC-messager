<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFC Group Text</title>
</head>
<body>
    <h2>Set Up Your Group Chat</h2>

    <label for="phoneNumbers">Phone Numbers (comma-separated if you want to text multiple):</label>
    <input type="text" id="phoneNumbers" placeholder="e.g. +1234567890, +0987654321">

    <br><br>

    <label for="messageSelect">Choose a Message:</label>
    <select id="messageSelect" onchange="checkCustomMessage()">
        <option value="I'm home">I'm home</option>
        <option value="On my way">On my way</option>
        <option value="Stuck in traffic">Stuck in traffic</option>
        <option value="At the store, need anything?">At the store, need anything?</option>
        <option value="Custom">Custom Message...</option>
    </select>

    <br><br>

    <input type="text" id="customMessage" placeholder="Enter your message" style="display:none;">

    <br><br>

    <button onclick="saveData()">Save</button>
    <p id="message"></p>

    <script>
        function checkCustomMessage() {
            let messageSelect = document.getElementById("messageSelect").value;
            let customMessageBox = document.getElementById("customMessage");

            if (messageSelect === "Custom") {
                customMessageBox.style.display = "block";
            } else {
                customMessageBox.style.display = "none";
            }
        }

        function saveData() {
            let numbers = document.getElementById("phoneNumbers").value;
            let messageSelect = document.getElementById("messageSelect").value;
            let customMessageBox = document.getElementById("customMessage").value;

            let finalMessage = (messageSelect === "Custom") ? customMessageBox : messageSelect;

            if (numbers && finalMessage) {
                localStorage.setItem("savedNumbers", numbers);
                localStorage.setItem("savedMessage", finalMessage);
                document.getElementById("message").innerText = "Saved! Tap the NFC tag again to send a message.";
            }
        }

        function sendMessage() {
            let savedNumbers = localStorage.getItem("savedNumbers");
            let savedMessage = localStorage.getItem("savedMessage");

            if (savedNumbers && savedMessage) {
                let formattedNumbers = savedNumbers.replace(/\s+/g, ''); // Remove spaces
                window.location.href = `sms:${formattedNumbers}?body=${encodeURIComponent(savedMessage)}`;
            }
        }

        // If user already saved data, auto-send the message
        if (localStorage.getItem("savedNumbers") && localStorage.getItem("savedMessage")) {
            sendMessage();
        }
    </script>
</body>
</html>
